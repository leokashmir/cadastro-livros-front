<div class="assunto-container">
  <nz-card nzTitle="Gerenciamento de Assuntos">
    <!-- Botão voltar -->
    <button
      nz-button
      nzType="link"
      (click)="goToDashboard()"
      class="back-button"
    >
      <span nz-icon nzType="arrow-left"></span>
      Voltar ao Dashboard
    </button>

    <!-- Barra de ações -->
    <div class="action-bar">
      <div class="search-section">
        <nz-input-group [nzSuffix]="suffixIconSearch" class="search-input">
          <input
            type="text"
            nz-input
            placeholder="Pesquisar por descrição"
            [(ngModel)]="searchText"
            (keyup.enter)="search()"
          />
        </nz-input-group>
        <ng-template #suffixIconSearch>
          <span nz-icon nzType="search"></span>
        </ng-template>
        <button nz-button nzType="primary" (click)="search()">
          <span nz-icon nzType="search"></span>
          Pesquisar
        </button>
        <button nz-button (click)="clearSearch()">
          <span nz-icon nzType="clear"></span>
          Limpar
        </button>
      </div>
      <button nz-button nzType="primary" (click)="showModal()">
        <span nz-icon nzType="plus"></span>
        Novo Assunto
      </button>
    </div>

    <!-- Tabela de assuntos -->
    <nz-table
      #assuntoTable
      [nzData]="filteredAssuntos"
      [nzPageSize]="pageSize"
      [nzPageIndex]="pageIndex"
      [nzLoading]="loading"
      [nzShowSizeChanger]="false"
      (nzPageIndexChange)="pageIndex = $event"
      class="assunto-table"
    >
      <thead>
        <tr>
          <th>Descrição</th>
          <th nzWidth="150px" nzAlign="center">Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let assunto of assuntoTable.data">
          <td>{{ assunto.descricao }}</td>
          <td nzAlign="center">
            <nz-space>
              <button
                *nzSpaceItem
                nz-button
                nzType="default"
                nzSize="small"
                (click)="showEditModal(assunto)"
                nz-tooltip
                nzTooltipTitle="Editar"
              >
                <span nz-icon nzType="edit" nzTheme="outline"></span>
              </button>
              <button
                *nzSpaceItem
                nz-button
                nzType="default"
                nzDanger
                nzSize="small"
                nz-popconfirm
                nzPopconfirmTitle="Tem certeza que deseja excluir este assunto?"
                nzPopconfirmPlacement="left"
                (nzOnConfirm)="deleteAssunto(assunto.id)"
                nz-tooltip
                nzTooltipTitle="Excluir"
              >
                <span nz-icon nzType="delete" nzTheme="outline"></span>
              </button>
            </nz-space>
          </td>
        </tr>
      </tbody>
    </nz-table>
  </nz-card>

  <!-- Modal para criar/editar assunto -->
  <nz-modal
    [(nzVisible)]="isModalVisible"
    [nzTitle]="isEditMode ? 'Editar Assunto' : 'Novo Assunto'"
    (nzOnCancel)="handleCancel()"
    (nzOnOk)="handleOk()"
    [nzOkText]="isEditMode ? 'Atualizar' : 'Criar'"
    nzCancelText="Cancelar"
  >
    <ng-container *nzModalContent>
      <form nz-form>
        <nz-form-item>
          <nz-form-label [nzSpan]="24" nzRequired>Descrição</nz-form-label>
          <nz-form-control [nzSpan]="24">
            <input
              nz-input
              [(ngModel)]="currentAssunto.descricao"
              name="descricao"
              placeholder="Digite a descrição do assunto"
              maxlength="20"
            />
            <small class="char-count">{{ currentAssunto.descricao.length }}/20 caracteres</small>
          </nz-form-control>
        </nz-form-item>
      </form>
    </ng-container>
  </nz-modal>
</div>
